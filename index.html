<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Write2PDF - محرر نصوص إلى PDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&family=Tajawal:wght@200;300;400;500;700;800;900&family=Almarai:wght@300;400;700;800&family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&family=Open+Sans:wght@300;400;500;600;700;800&family=Noto+Kufi+Arabic:wght@100;200;300;400;500;600;700;800;900&family=Noto+Naskh+Arabic:wght@400;500;600;700&family=Readex+Pro:wght@200;300;400;500;600;700&family=Reem+Kufi:wght@400;500;600;700&family=Lato:wght@100;300;400;700;900&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Modern Professional Color Scheme */
            --primary: #0284c7; /* Sky blue */
            --primary-rgb: 2, 132, 199;
            --primary-dark: #0369a1;
            --primary-light: #38bdf8;
            --secondary: #6366f1; /* Indigo */
            --accent: #818cf8;
            
            /* Neutral Colors */
            --bg-light: #f8fafc;
            --bg-dark: #0f172a;
            --text-light: #334155;
            --text-dark: #e2e8f0;
            
            /* UI Colors */
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --info: #2563eb;

            /* Surface Colors */
            --surface-light: rgba(255, 255, 255, 0.9);
            --surface-dark: rgba(15, 23, 42, 0.9);
            --border-light: rgba(2, 132, 199, 0.1);
            --border-dark: rgba(56, 189, 248, 0.1);
        }

        /* Modern Gradient Background */
        .animated-bg {
            background: linear-gradient(135deg, 
                rgba(2, 132, 199, 0.05),
                rgba(99, 102, 241, 0.05),
                rgba(56, 189, 248, 0.05)
            );
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        /* Glass Morphism 2.0 */
        .glass-panel {
            background: var(--surface-light);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.05),
                0 2px 4px -1px rgba(0, 0, 0, 0.03),
                0 0 0 1px rgba(2, 132, 199, 0.05);
        }

        .dark .glass-panel {
            background: var(--surface-dark);
            border-color: var(--border-dark);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.2),
                0 2px 4px -1px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(56, 189, 248, 0.1);
        }

        /* Modern Button Design */
        .modern-button {
            background: var(--surface-light);
            color: var(--primary);
            border: 1px solid var(--border-light);
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 2px 4px rgba(2, 132, 199, 0.05),
                0 0 0 1px rgba(2, 132, 199, 0.05);
        }

        .modern-button:hover {
            transform: translateY(-1px);
            background: var(--primary);
            color: white;
            box-shadow: 
                0 4px 12px rgba(2, 132, 199, 0.15),
                0 0 0 1px rgba(2, 132, 199, 0.1);
        }

        /* Export PDF Button specific style */
        .export-pdf-btn {
            background: linear-gradient(135deg, #0ea5e9, #2563eb);
            color: white;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2),
                       0 2px 4px -2px rgba(37, 99, 235, 0.1);
            transition: all 0.3s ease;
        }

        .export-pdf-btn:hover {
            background: linear-gradient(135deg, #0284c7, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 8px 12px -1px rgba(37, 99, 235, 0.2),
                       0 4px 6px -2px rgba(37, 99, 235, 0.1);
        }

        .dark .export-pdf-btn {
            background: linear-gradient(135deg, #38bdf8, #6366f1);
        }

        .dark .export-pdf-btn:hover {
            background: linear-gradient(135deg, #0ea5e9, #4f46e5);
        }

        /* Editor Enhancements */
        .editor-container {
            background: var(--surface-light);
            border-radius: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        #editor {
            padding: 2rem;
            background: var(--surface-light) !important;
            color: var(--text-light) !important;
            box-shadow: inset 0 0 0 1px var(--border-light);
            border-radius: 0.75rem;
        }

        .dark #editor {
            background: var(--surface-dark) !important;
            color: var(--text-dark) !important;
            box-shadow: inset 0 0 0 1px var(--border-dark);
        }

        /* Toolbar Redesign */
        .toolbar-wrapper {
            background: var(--surface-light);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Settings Panel Enhancement */
        .settings-container {
            background: var(--surface-light);
            border-radius: 1rem;
            padding: 1.5rem;
            gap: 1.5rem;
        }

        /* Input Styling */
        .modern-input {
            border-radius: 0.75rem;
            border: 1px solid var(--border-light);
            padding: 0.75rem;
            transition: all 0.2s ease;
            background: var(--surface-light);
        }

        .modern-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1);
        }

        /* Header Enhancement */
        .site-header {
            background: var(--surface-light);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(12px);
        }

        /* Developer Credit Enhancement */
        .developer-credit-header {
            background: linear-gradient(135deg,
                rgba(2, 132, 199, 0.1),
                rgba(56, 189, 248, 0.1)
            );
            border: 1px solid var(--border-light);
            padding: 0.75rem 1.5rem;
            border-radius: 1rem;
            color: var(--primary);
            font-weight: 500;
            letter-spacing: 0.025em;
        }

        /* Preview Modal Enhancement */
        .preview-modal {
            background: var(--surface-light);
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Text Selection */
        ::selection {
            background: var(--primary);
            color: white;
        }

        /* Enhanced Dark Mode */
        .dark {
            background-color: var(--bg-dark) !important;
        }

        .dark .site-header,
        .dark .settings-container,
        .dark .toolbar-wrapper,
        .dark .editor-container,
        .dark .preview-modal {
            background: rgba(15, 23, 42, 0.95) !important;
            border-color: rgba(51, 65, 85, 0.5);
        }

        /* Social Media Link Style */
        .social-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(45deg, #833ab4, #fd1d1d, #fcb045);
            color: white;
            border-radius: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            margin-right: 1rem;
        }

        .social-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(131, 58, 180, 0.3);
        }

        .dark .social-link {
            opacity: 0.9;
        }

        .dark .social-link:hover {
            opacity: 1;
        }

        /* List Styling Improvements */
        #editor ul, #editor ol {
            list-style-position: inside !important;
            padding-right: 1.5rem !important;
            padding-left: 1.5rem !important;
            margin: 1rem 0 !important;
        }

        #editor ul {
            list-style-type: disc !important;
        }

        #editor ol {
            list-style-type: decimal !important;
        }

        #editor li {
            display: list-item !important;
            margin: 0.5rem 0 !important;
            padding-right: 0.5rem !important;
        }

        #editor li > * {
            display: inline-block !important;
        }

        /* Fix list appearance in dark mode */
        .dark #editor ul,
        .dark #editor ol {
            color: var(--text-dark) !important;
        }

        /* Ensure lists are visible in PDF */
        .pdf-element ul,
        .pdf-element ol {
            list-style-position: inside !important;
            padding-right: 2em !important;
            padding-left: 2em !important;
        }

        .pdf-element ul { list-style-type: disc !important; }
        .pdf-element ol { list-style-type: decimal !important; }
        .pdf-element li { 
            display: list-item !important;
            margin: 0.5em 0 !important;
        }
    </style>
</head>
<body class="light bg-gray-50 text-gray-800" dir="rtl">
    <div class="animated-bg"></div>
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="site-header">
            <div class="container mx-auto flex justify-between items-center flex-wrap gap-4">
                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                    <i class="fas fa-file-pdf text-blue-500 dark:text-blue-400 text-2xl"></i>
                    <h1 class="text-xl font-bold text-blue-500 dark:text-blue-400">Write2PDF</h1>
                </div>
                
                <div class="developer-credit-header">
                    <i class="fas fa-graduation-cap"></i>
                    <span>م. علي عبدمسلم</span>
                </div>

                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                    <button id="languageSwitch" class="modern-button language-switch">
                        <span class="lang-ar">العربية</span>
                        <span class="lang-en hidden">English</span>
                        <i class="fas fa-globe"></i>
                    </button>
                    <button id="themeToggle" class="modern-button">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                    <a href="https://www.instagram.com/c4man" target="_blank" class="social-link">
                        <i class="fab fa-instagram"></i>
                        <span class="lang-ar">إنستغرام</span>
                        <span class="lang-en hidden">Instagram</span>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 container mx-auto px-4 py-6">
            <div class="editor-section">
                <!-- Settings Container -->
                <div class="settings-container glass-panel realistic-shadow">
                    <div class="setting-group">
                        <label class="block text-sm font-medium mb-2">نوع الخط</label>
                        <select id="fontFamily" class="modern-input w-full">
                            <optgroup label="خطوط عربية">
                                <option value="Cairo, var(--fonts-ar)" style="font-family: Cairo">Cairo - القاهرة</option>
                                <option value="Tajawal, var(--fonts-ar)" style="font-family: Tajawal">Tajawal - تجوال</option>
                                <option value="Almarai, var(--fonts-ar)" style="font-family: Almarai">Almarai - المراعي</option>
                                <option value="Noto Kufi Arabic, var(--fonts-ar)" style="font-family: 'Noto Kufi Arabic'">Noto Kufi - نوتو كوفي</option>
                                <option value="Noto Naskh Arabic, var(--fonts-ar)" style="font-family: 'Noto Naskh Arabic'">Noto Naskh - نوتو نسخ</option>
                                <option value="Readex Pro, var(--fonts-ar)" style="font-family: 'Readex Pro'">Readex Pro - ريدكس برو</option>
                                <option value="Reem Kufi, var(--fonts-ar)" style="font-family: 'Reem Kufi'">Reem Kufi - ريم كوفي</option>
                            </optgroup>
                            <optgroup label="English Fonts">
                                <option value="Poppins, var(--fonts-en)" style="font-family: Poppins">Poppins</option>
                                <option value="Montserrat, var(--fonts-en)" style="font-family: Montserrat">Montserrat</option>
                                <option value="Lato, var(--fonts-en)" style="font-family: Lato">Lato</option>
                                <option value="Roboto, var(--fonts-en)" style="font-family: Roboto">Roboto</option>
                                <option value="Open Sans, var(--fonts-en)" style="font-family: 'Open Sans'">Open Sans</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label class="block text-sm font-medium mb-2">حجم الخط</label>
                        <select id="fontSize" class="modern-input w-full">
                            <option value="12px">صغير (12px)</option>
                            <option value="14px" selected>متوسط (14px)</option>
                            <option value="16px">كبير (16px)</option>
                            <option value="18px">كبير جداً (18px)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label class="block text-sm font-medium mb-2">حجم الصفحة</label>
                        <select id="pageSize" class="modern-input w-full">
                            <option value="a4">A4</option>
                            <option value="letter">Letter</option>
                            <option value="legal">Legal</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label class="block text-sm font-medium mb-2">اتجاه الصفحة</label>
                        <div class="flex gap-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="orientation" value="portrait" checked class="modern-input h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-slate-600 dark:bg-slate-700">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">
                                    <span class="lang-ar">عمودي</span>
                                    <span class="lang-en hidden">Portrait</span>
                                </span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="orientation" value="landscape" class="modern-input h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-slate-600 dark:bg-slate-700">
                                <span class="ml-2 text-gray-700 dark:text-gray-300">
                                    <span class="lang-ar">أفقي</span>
                                    <span class="lang-en hidden">Landscape</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Editor and Toolbar -->
                <div class="editor-container glass-panel realistic-shadow">
                    <div class="toolbar-wrapper">
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="bold">
                            <i class="fas fa-bold"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">عريض</span>
                            <span class="lang-en hidden">Bold</span>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="italic">
                            <i class="fas fa-italic"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">مائل</span>
                            <span class="lang-en hidden">Italic</span>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="underline">
                            <i class="fas fa-underline"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">تسطير</span>
                            <span class="lang-en hidden">Underline</span>
                        </button>
                        <div class="h-6 border-l border-gray-300 dark:border-slate-600 mx-1"></div>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="justifyLeft">
                            <i class="fas fa-align-left"></i>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="justifyCenter">
                            <i class="fas fa-align-center"></i>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="justifyRight">
                            <i class="fas fa-align-right"></i>
                        </button>
                        <div class="h-6 border-l border-gray-300 dark:border-slate-600 mx-1"></div>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="insertUnorderedList">
                            <i class="fas fa-list-ul"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">قائمة</span>
                            <span class="lang-en hidden">List</span>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="insertOrderedList">
                            <i class="fas fa-list-ol"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">مرقمة</span>
                            <span class="lang-en hidden">Numbered</span>
                        </button>
                        <div class="h-6 border-l border-gray-300 dark:border-slate-600 mx-1"></div>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="createLink">
                            <i class="fas fa-link"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">رابط</span>
                            <span class="lang-en hidden">Link</span>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 rounded-md" data-command="unlink">
                            <i class="fas fa-unlink"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">إزالة</span>
                            <span class="lang-en hidden">Remove</span>
                        </button>
                        <button class="modern-button toolbar-btn px-3 py-1 bg-red-100 dark:bg-red-900 rounded-md text-red-600 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800 ml-auto rtl:ml-0 rtl:mr-auto" id="clearContent">
                            <i class="fas fa-trash-alt"></i>
                            <span class="lang-ar mr-1 rtl:mr-0 rtl:ml-1">مسح الكل</span>
                            <span class="lang-en hidden">Clear All</span>
                        </button>
                    </div>
                    <div id="editor" contenteditable="true" class="min-h-[400px] p-6"></div>
                    <div class="resize-handle" title="اسحب لتغيير الحجم"></div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-center gap-4">
                    <button id="previewBtn" class="modern-button hover:bg-primary-light">
                        <i class="fas fa-eye"></i>
                        <span class="lang-ar">معاينة</span>
                        <span class="lang-en hidden">Preview</span>
                    </button>
                    <button id="exportPdf" class="modern-button export-pdf-btn">
                        <i class="fas fa-file-pdf"></i>
                        <span class="lang-ar">تحويل إلى PDF</span>
                        <span class="lang-en hidden">Export to PDF</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Preview Modal -->
        <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="preview-modal">
                <div class="flex justify-between items-center border-b border-gray-200 dark:border-slate-700 px-6 py-4">
                    <h3 class="text-lg font-bold text-gray-700 dark:text-gray-200">
                        <span class="lang-ar">معاينة PDF</span>
                        <span class="lang-en hidden">PDF Preview</span>
                    </h3>
                    <button id="closePreview" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-auto p-6">
                    <div id="previewContent" class="bg-white dark:bg-slate-800 p-6 border border-gray-200 dark:border-slate-700 rounded-lg"></div>
                </div>
                <div class="border-t border-gray-200 dark:border-slate-700 px-6 py-4 flex justify-end">
                    <button id="exportFromPreview" class="modern-button export-pdf-btn px-4 py-2">
                        <i class="fas fa-file-pdf mr-2 rtl:mr-0 rtl:ml-2"></i>
                        <span class="lang-ar">تحويل إلى PDF</span>
                        <span class="lang-en hidden">Export to PDF</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Toggle
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            body.classList.add(savedTheme);
            
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('dark');
                body.classList.toggle('light');
                const currentTheme = body.classList.contains('dark') ? 'dark' : 'light';
                localStorage.setItem('theme', currentTheme);
            });

            // Language Toggle
            const languageSwitch = document.getElementById('languageSwitch');
            const html = document.documentElement;
            
            // Check for saved language preference
            const savedLang = localStorage.getItem('language') || 'ar';
            if (savedLang === 'en') {
                toggleLanguage();
            }
            
            languageSwitch.addEventListener('click', toggleLanguage);
            
            function toggleLanguage() {
                const currentLang = html.getAttribute('lang');
                const newLang = currentLang === 'ar' ? 'en' : 'ar';
                const newDir = newLang === 'ar' ? 'rtl' : 'ltr';
                
                html.setAttribute('lang', newLang);
                html.setAttribute('dir', newDir);
                
                document.querySelectorAll('.lang-ar').forEach(el => el.classList.toggle('hidden'));
                document.querySelectorAll('.lang-en').forEach(el => el.classList.toggle('hidden'));
                
                localStorage.setItem('language', newLang);
            }

            // Editor Functionality
            const editor = document.getElementById('editor');
            const toolbarBtns = document.querySelectorAll('[data-command]');
            const clearContent = document.getElementById('clearContent');
            
            // Load saved content
            const savedContent = localStorage.getItem('editorContent');
            if (savedContent) {
                editor.innerHTML = savedContent;
            }
            
            // Save content on input
            let saveTimeout;
            editor.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    localStorage.setItem('editorContent', editor.innerHTML);
                }, 500);
            });
            
            // Toolbar buttons
            toolbarBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const command = btn.getAttribute('data-command');
                    
                    if (command === 'insertUnorderedList' || command === 'insertOrderedList') {
                        document.execCommand(command, false, null);
                        
                        // Fix list styling after insertion
                        const lists = editor.querySelectorAll(command === 'insertUnorderedList' ? 'ul' : 'ol');
                        lists.forEach(list => {
                            list.style.listStylePosition = 'inside';
                            list.style.paddingRight = '1.5rem';
                            list.style.paddingLeft = '1.5rem';
                            list.style.margin = '1rem 0';
                            list.style.listStyleType = command === 'insertUnorderedList' ? 'disc' : 'decimal';
                            
                            // Fix individual list items
                            list.querySelectorAll('li').forEach(item => {
                                item.style.display = 'list-item';
                                item.style.marginBottom = '0.5rem';
                            });
                        });
                    } else if (command === 'createLink') {
                        const url = prompt('أدخل الرابط:', 'https://');
                        if (url) document.execCommand(command, false, url);
                    } else {
                        document.execCommand(command, false, null);
                    }
                    
                    editor.focus();
                });
            });
            
            // Clear content
            clearContent.addEventListener('click', () => {
                if (confirm('هل أنت متأكد أنك تريد مسح كل المحتوى؟')) {
                    editor.innerHTML = '';
                    localStorage.setItem('editorContent', '');
                }
            });

            // PDF Export
            const exportPdf = document.getElementById('exportPdf');
            const exportFromPreview = document.getElementById('exportFromPreview');
            const previewBtn = document.getElementById('previewBtn');
            const previewModal = document.getElementById('previewModal');
            const closePreview = document.getElementById('closePreview');
            const previewContent = document.getElementById('previewContent');
            
            exportPdf.addEventListener('click', generatePdf);
            exportFromPreview.addEventListener('click', generatePdf);
            
            previewBtn.addEventListener('click', () => {
                previewContent.innerHTML = editor.innerHTML;
                applyPreviewStyles();
                previewModal.classList.remove('hidden');
            });
            
            closePreview.addEventListener('click', () => {
                previewModal.classList.add('hidden');
            });
            
            function applyPreviewStyles() {
                const fontFamily = document.getElementById('fontFamily').value;
                const fontSize = document.getElementById('fontSize').value;
                
                previewContent.style.fontFamily = fontFamily;
                previewContent.style.fontSize = fontSize;
                previewContent.style.lineHeight = '1.6';
                previewContent.style.color = body.classList.contains('dark') ? '#f8fafc' : '#1f2937';
            }
            
            function generatePdf() {
                const pageSize = document.getElementById('pageSize').value;
                const orientation = document.querySelector('input[name="orientation"]:checked').value;
                const margins = parseInt(document.getElementById('pageMargins').value);
                const fontFamily = document.getElementById('fontFamily').value;
                const fontSize = document.getElementById('fontSize').value;
                
                const element = document.createElement('div');
                element.className = 'pdf-element';
                element.style.fontFamily = fontFamily;
                element.style.fontSize = fontSize;
                element.style.direction = document.documentElement.dir;
                element.innerHTML = editor.innerHTML.replace(/<p>/g, '<p class="numbered">');
                
                // Add specific styles for PDF
                const styles = `
                    .pdf-element {
                        font-family: ${fontFamily} !important;
                        font-size: ${fontSize} !important;
                        color: #000 !important;
                        line-height: 1.6 !important;
                        direction: ${document.documentElement.dir} !important;
                    }
                    .pdf-element * {
                        font-family: ${fontFamily} !important;
                        color: #000 !important;
                    }
                    .pdf-element ul, .pdf-element ol {
                        padding-right: 2em !important;
                        padding-left: 2em !important;
                        margin: 1em 0 !important;
                        list-style-position: inside !important;
                    }
                    .pdf-element ul { list-style-type: disc !important; }
                    .pdf-element ol { list-style-type: decimal !important; }
                    .pdf-element li { margin: 0.5em 0 !important; }
                    .pdf-element p:not(:empty) {
                        counter-increment: paragraph;
                        position: relative;
                        padding-right: 2.5rem;
                    }
                    .pdf-element p:not(:empty)::before {
                        content: counter(paragraph);
                        position: absolute;
                        right: 0;
                        color: var(--primary);
                        font-weight: bold;
                    }
                `;
                
                const styleSheet = document.createElement('style');
                styleSheet.textContent = styles;
                element.appendChild(styleSheet);
                
                const opt = {
                    margin: margins,
                    filename: 'document.pdf',
                    image: { type: 'jpeg', quality: 1 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        dpi: 192,
                        letterRendering: true,
                        backgroundColor: '#ffffff',
                        windowWidth: 1024,
                        scrollY: 0,
                        scrollX: 0
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: pageSize, 
                        orientation: orientation,
                        compress: true,
                        precision: 16,
                        enableLinks: true,
                        fontFaces: true
                    }
                };
                
                // Show loading indicator
                const loadingEl = document.createElement('div');
                loadingEl.innerHTML = '<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white p-4 rounded-lg">جاري التحويل...</div></div>';
                document.body.appendChild(loadingEl);
                
                // Create temporary container for better rendering
                const container = document.createElement('div');
                container.style.position = 'absolute';
                container.style.left = '-9999px';
                container.style.top = '0';
                container.style.width = '1024px';
                container.appendChild(element);
                document.body.appendChild(container);
                
                html2pdf()
                    .set(opt)
                    .from(element)
                    .save()
                    .then(() => {
                        loadingEl.remove();
                        container.remove();
                    })
                    .catch(err => {
                        console.error('PDF generation error:', err);
                        loadingEl.remove();
                        container.remove();
                        alert('حدث خطأ أثناء إنشاء PDF. يرجى المحاولة مرة أخرى.');
                    });
            }

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === previewModal) {
                    previewModal.classList.add('hidden');
                }
            });

            // Add smooth scrolling
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // Editor resize functionality
            const editorContainer = document.querySelector('.editor-container');
            const resizeHandle = document.querySelector('.resize-handle');
            let isResizing = false;
            let startHeight;
            let startY;

            resizeHandle.addEventListener('mousedown', initResize);
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);

            // Touch support
            resizeHandle.addEventListener('touchstart', initResize);
            document.addEventListener('touchmove', resize);
            document.addEventListener('touchend', stopResize);

            function initResize(e) {
                isResizing = true;
                startHeight = editorContainer.offsetHeight;
                startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
                
                // Add temporary overlay to prevent text selection while resizing
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; inset: 0; z-index: 9999; cursor: row-resize;';
                overlay.id = 'resize-overlay';
                document.body.appendChild(overlay);
            }

            function resize(e) {
                if (!isResizing) return;
                
                const currentY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
                const delta = currentY - startY;
                const newHeight = Math.max(200, Math.min(window.innerHeight * 0.8, startHeight + delta));
                
                editorContainer.style.height = `${newHeight}px`;
                e.preventDefault();
            }

            function stopResize() {
                isResizing = false;
                const overlay = document.getElementById('resize-overlay');
                if (overlay) overlay.remove();
            }

            // Font Family Preview
            const fontSelect = document.getElementById('fontFamily');
            fontSelect.addEventListener('change', function() {
                editor.style.fontFamily = this.value;
                this.style.fontFamily = this.value.split(',')[0];
            });

            // Initialize font preview on load
            fontSelect.style.fontFamily = fontSelect.value.split(',')[0];

            // Enhance list commands
            const listButtons = document.querySelectorAll('[data-command^="insert"]');
            listButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const command = btn.getAttribute('data-command');
                    document.execCommand(command, false, null);
                    
                    // Fix list styling after insertion
                    const lists = editor.querySelectorAll('ul, ol');
                    lists.forEach(list => {
                        if (command === 'insertUnorderedList') {
                            list.style.listStyleType = 'disc';
                        } else {
                            list.style.listStyleType = 'decimal';
                        }
                        list.style.paddingInlineStart = '2em';
                    });
                    
                    editor.focus();
                });
            });

            // Auto add paragraphs on Enter key
            editor.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    // Wait for the default enter behavior
                    setTimeout(() => {
                        const selection = window.getSelection();
                        const range = selection.getRangeAt(0);
                        const node = range.commonAncestorContainer;

                        if (node.nodeType === 3 && node.parentNode === editor) {
                            // Text node directly in editor
                            const p = document.createElement('p');
                            p.appendChild(node.cloneNode());
                            node.parentNode.replaceChild(p, node);
                            
                            // Place cursor in new paragraph
                            range.selectNodeContents(p);
                            range.collapse(false);
                            selection.removeAllRanges();
                            selection.addRange(range);
                        }
                    }, 0);
                }
            });

            // Handle paste to maintain paragraph structure
            editor.addEventListener('paste', function(e) {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                const paragraphs = text.split(/\n\s*\n/);
                
                const fragment = document.createDocumentFragment();
                paragraphs.forEach(content => {
                    if (content.trim()) {
                        const p = document.createElement('p');
                        p.textContent = content.trim();
                        fragment.appendChild(p);
                    }
                });
                
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(fragment);
            });
        });
    </script>
</body>
</html>